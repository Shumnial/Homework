{"version":3,"sources":["common.js"],"names":["$","onDeleteButtonClick","contact","this","closest","id","attr","element","userStore","findIndex","el","splice","saveToLocal","addClass","setTimeout","remove","makeList","newId","init","myPlacemark","node","contactsList","nodes","map","coords","myMap","setCenter","ymaps","Placemark","hintContent","name","lastname","balloonContent","geoObjects","add","address","tel","html","ready","getInitial","data","localStorage","getItem","JSON","parse","setItem","stringify","sortContacts","sort","a","b","Map","center","zoom","getCoords","myGeocoder","geocode","then","res","geoObj","get","geometry","getCoordinates","err","console","log","handleSubmit","evt","preventDefault","formValue","val","match","find","formTel","removeClass","result","serializeArray","obj","forEach","value","Date","now","push","alert","contactsForm","on","document"],"mappings":"AAAA,YAAAA,GAAE,WAiBF,QAASC,KACP,GAAMC,GAAUF,EAAEG,MAAMC,QAAQ,cAC1BC,GAAML,EAAEE,GAASI,KAAK,WACtBC,EAAUC,EAAUC,UAAU,SAACC,GACpC,MAAOA,GAAGL,KAAOA,GAGlBG,GAAUG,OAAOJ,EAAS,GAC1BK,IACAV,EAAQW,SAAS,0BACjBC,WAAW,WACVZ,EAAQa,UACN,KAcL,QAASC,GAAUC,GAElB,QAASC,KACR,GAAIC,GAAAA,OACEC,EAAOC,EACTC,EAAQd,EAAUe,IAAI,SAACb,GAC1B,GAAIG,GAAWI,IAAUP,EAAGL,GAAK,2BAA6B,EAa9D,OAZIK,GAAGc,SACNC,EAAMC,UAAUhB,EAAGc,OAAQ,IAC3BL,EAAc,GAAIQ,OAAMC,UAAUlB,EAAGc,QAEpCK,YAAgBnB,EAAGoB,KAAnB,IAA2BpB,EAAGqB,SAC9BC,eAAAA,MAAsBtB,EAAGoB,KAAzB,IAAiCpB,EAAGqB,SAApC,yDAEDN,EAAMQ,WAAWC,IAAIf,IAKtB,wBAA+BN,EAA/B,cAAqDH,EAAGL,GAAxD,+CAAyGK,EAAGqB,SAA5G,mDACoCrB,EAAGoB,KADvC,kDAEmCpB,EAAGyB,QAFtC,kDAGmCzB,EAAG0B,IAHtC,4EAMDhB,GAAKiB,KAAKf,GAxBXK,MAAMW,MAAMpB,GA6Bb,QAASqB,KACR,GAAMC,GAAOC,aAAaC,QAAQ,QAC9BF,KACJhC,EAAYmC,KAAKC,MAAMJ,IAGxB,QAAS5B,KACR6B,aAAaI,QAAQ,QAASF,KAAKG,UAAUtC,IAG9C,QAASuC,KACPvC,EAAUwC,KAAK,SAAUC,EAAGC,GAC1B,MAAID,GAAElB,SAAWmB,EAAEnB,YAGfkB,EAAElB,SAAWmB,EAAEnB,SACV,EAEF,IAOV,QAASb,KACRO,EAAQ,GAAIE,OAAMwB,IAAI,OACrBC,QAAS,MAAO,MAChBC,KAAM,KAGR,QAASC,GAAWnB,GACnB,GAAIoB,GAAa5B,MAAM6B,QAAQrB,EAC/B,OAAOoB,GAAWE,KAAK,SAAAC,GACtB,GAAIC,GAASD,EAAIzB,WAAW2B,IAAI,GAC5BpC,EAASmC,EAASA,EAAOE,SAASC,iBAAmB,IACzD,OAAOtC,KAHD+B,SAKA,SAAAQ,GAAA,MAAOC,SAAQC,IAAI,QAASF,KAIrC,QAASG,GAAaC,GACrBA,EAAIC,gBACJ,IAAIC,GAAYrE,EAAE,yBAAyBsE,MACvCC,EAAQ/D,EAAUgE,KAAK,SAAA9D,GAAA,MAAKA,GAAG0B,MAAQiC,GAE3C,IAAGE,EAEF,WADAE,GAAQ5D,SAAS,gCAGjB4D,GAAQC,YAAY,gCAErB,IAAMC,GAAS3E,EAAEG,MAAMyE,iBACjBC,IACNF,GAAOG,QAAQ,SAACpE,GACfmE,EAAInE,EAAGoB,MAAQpB,EAAGqE,QAEnBF,EAAIxE,GAAK2E,KAAKC,MAEd3B,EAAUuB,EAAI1C,SAASsB,KAAK,SAAAjB,GAC3B,MAAIA,IAIJqC,EAAIrD,OAASgB,EACbhC,EAAU0E,KAAKL,GACf9B,IACAnC,QACAI,GAAS6D,EAAIxE,SAPZ8E,OAAM,oBAtIT,GAAIC,GAAepF,EAAE,oBACjBqB,EAAerB,EAAE,oBAIjByE,GAFWzE,EAAE,0BACEA,EAAE,8BACPA,EAAE,0BAQZQ,IACJ+B,KAiFCZ,MAAMW,MAAMpB,EACZ,IAAIO,EAiDLT,KAEAoE,EAAaC,GAAG,SAAUnB,GAC1BlE,EAAEsF,UAAUD,GAAG,QAAS,yBAA0BpF","file":"../sources/common.js","sourcesContent":["$(function() {\r\nlet contactsForm = $('.c-contacts-form');\r\nlet contactsList = $('.c-contacts-list');\r\nlet persons = [{'name': 'Андрей', 'lastname': 'Андреевич'}, {'name': 'Борис', 'lastname': 'Борисович'}, {'name': 'Виктор', 'lastname': 'Викторович'}];\r\nlet formName = $('.c-contacts-form__name');\r\nlet formLastname = $('.c-contacts-form__lastname');\r\nlet formTel = $('.c-contacts-form__tel');\r\n\r\n/* function makeMask () {\r\n\t  formTel.inputmask({\"mask\": \"+7(999) 999-9999\"});\r\n}\r\nmakeMask();\r\n*/\r\n\r\nlet userStore = [];\r\ngetInitial();\r\n\r\nfunction onDeleteButtonClick () {\r\n\t\tconst contact = $(this).closest('.c-contact');\r\n\t\tconst id = +$(contact).attr('data-id');\r\n\t\tconst element = userStore.findIndex((el)=> {\r\n\t\t\treturn el.id === id;\r\n\t\t});\r\n\r\n\t\tuserStore.splice(element, 1);\r\n\t\tsaveToLocal();\r\n\t\tcontact.addClass('c-contact--slide-right');\r\n\t\tsetTimeout(function () {\r\n\t\t\tcontact.remove();\r\n\t\t}, 250)\r\n};\r\n\r\nfunction User (data) {\r\n\tconst self = this;\r\n\tthis.name = data.name;\r\n\tthis.lastname = data.lastname;\r\n\r\n\tthis.getFullName = function() {\r\n\t\tconsole.log(self.name + ' ' + self.lastname)\r\n\t\treturn self.name + self.lastname;\r\n\t}\r\n};\r\n\r\nfunction makeList (newId) {\r\n\tymaps.ready(init);\r\n\tfunction init(){\r\n\t\tlet myPlacemark;\r\n\t\tconst node = contactsList;\r\n\t\tlet nodes = userStore.map((el) => {\r\n\t\t\tlet addClass = newId === el.id ? 'c-contact--slide-default' : '';\r\n\t\t\tif (el.coords) {\r\n\t\t\t\tmyMap.setCenter(el.coords, 18);\r\n\t\t\t\tmyPlacemark = new ymaps.Placemark(el.coords, \r\n\t\t\t\t{\r\n\t\t\t\t\thintContent: `${el.name} ${el.lastname}`,\r\n\t\t\t\t\tballoonContent: `<p>${el.name} ${el.lastname}</p><button class=\"remove-placemark\">DELETE</button>` \r\n\t\t\t\t});\r\n\t\t\t\tmyMap.geoObjects.add(myPlacemark);\r\n\t\t\t\t/*myPlacemark.events.add('click', function () {\r\n\t\t\t\t\tmyMap.geoObjects.remove(myPlacemark);\r\n\t\t\t\t}); */\r\n\t\t\t};\r\n\t\t\treturn `<li class=\"c-contact ${addClass}\" data-id=\"${el.id}\"><div class=\"c-contact__lastname\">Фамилия: ${el.lastname}</div>\r\n\t\t\t<div class=\"c-contact__name\">Имя: ${el.name}</div>\r\n\t\t\t<div class=\"c-contacts__address\">${el.address}</div>\r\n\t\t\t<div class=\"c-contact__tel\">Тел: ${el.tel}</div>\r\n\t\t\t<button class=\"c-contact__delete-btn\">DELETE</button></li>`\r\n\t\t});\r\n\t\tnode.html(nodes);\r\n\t}\r\n};\r\n\r\n// Проверяет localStorage на наличие списка контактов\r\nfunction getInitial () {\r\n\tconst data = localStorage.getItem('users');\r\n\tif(!data) return;\r\n\tuserStore = JSON.parse(data);\r\n};\r\n// Сохраняет объект контактов в localStorage\r\nfunction saveToLocal () {\r\n\tlocalStorage.setItem('users', JSON.stringify(userStore));\r\n} ;\r\n// Сортирует контакты по фамилии\r\nfunction sortContacts () {\r\n  userStore.sort(function (a, b) {\r\n    if (a.lastname < b.lastname) {\r\n      return -1;\r\n    }\r\n    if (a.lastname > b.lastname) {\r\n      return 1;\r\n    }\r\n    return 0;\r\n  });\r\n};\r\n\r\n// MAP START\r\n\tymaps.ready(init);\r\n\tvar myMap;\r\n\tfunction init(){     \r\n\t\tmyMap = new ymaps.Map(\"map\", {\r\n\t\t\tcenter: [56.84, 60.60],\r\n\t\t\tzoom: 11\r\n\t\t});\r\n\t};\r\n\tfunction getCoords (address) {\r\n\t\tlet myGeocoder = ymaps.geocode(address);\r\n\t\treturn myGeocoder.then(res => {\r\n\t\t\tlet geoObj = res.geoObjects.get(0);\r\n\t\t\tlet coords = geoObj ? geoObj.geometry.getCoordinates() : null;\r\n\t\t\treturn coords;\r\n\t\t})\r\n\t\t.catch(err => console.log(\"err: \", err))\r\n\t};\r\n// MAP END\r\n\r\nfunction handleSubmit(evt) {\r\n\tevt.preventDefault();\r\n\tlet formValue = $('.c-contacts-form__tel').val();\r\n\tlet match = userStore.find(el=> el.tel === formValue);\r\n\r\n\tif(match) {\r\n\t\tformTel.addClass('c-contacts-form__tel--invalid');\r\n\t\treturn;\r\n\t} else {\r\n\t\tformTel.removeClass('c-contacts-form__tel--invalid');\r\n\t};\r\n\tconst result = $(this).serializeArray();\r\n\tconst obj = {};\r\n\tresult.forEach((el) => {\r\n\t\tobj[el.name] = el.value;\r\n\t});\r\n\tobj.id = Date.now();\r\n\r\n\tgetCoords(obj.address).then(data => {\r\n\t\tif(!data) {\r\n\t\t\talert('Неверный адрес');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tobj.coords = data;\r\n\t\tuserStore.push(obj);\r\n\t\tsortContacts();\r\n\t\tsaveToLocal();\r\n\t\tmakeList(obj.id);\r\n\t})\r\n};\r\n\r\nmakeList();\r\n\r\ncontactsForm.on('submit', handleSubmit);\r\n$(document).on('click', '.c-contact__delete-btn', onDeleteButtonClick);\r\n});"]}